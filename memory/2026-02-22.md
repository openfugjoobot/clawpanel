# Memory - 2026-02-22

## Issue #22 WebSocket Real-Time Dashboard - Complete

### Implementation
- Backend WebSocket server on `/ws` path using native `ws` library
- Token-based auth via `?token=base64(user:pass)` query parameter
- CORS logging for cross-origin requests
- Event broadcasting for sessions, agents, cron, gateway status

### Architecture
- **Frontend**: `https://clawpanel.fugjoo.duckdns.org` (port 3000, Vite dev)
- **Backend/WebSocket**: `https://clawserver.fugjoo.duckdns.org` (port 3001, HTTPS)
- Cross-origin WebSocket from frontend to backend subdomain

### Auth Fix (Late Night Session)
- Problem: Frontend not sending credentials because login didn't store password
- Solution: Added `credentials` field to AuthContext that stores base64-encoded `username:password`
- Updated `AuthContext.tsx` to save `credentials` in localStorage on login
- Updated `Dashboard.tsx` to decode and use stored credentials for WebSocket

### Files Modified
- `src/websocket/auth.ts` - Auth with CORS logging
- `src/websocket/server.ts` - WebSocket server
- `frontend/src/context/AuthContext.tsx` - Added credentials field
- `frontend/src/pages/Dashboard.tsx` - Use credentials from auth context
- `frontend/src/hooks/useWebSocket.ts` - WebSocket hook with reconnect logic

### After Code Changes
- User MUST logout and re-login to save new credentials to localStorage
- Then refresh page - WebSocket should show ðŸŸ¢ Connected

### Commits
- `9e50570` - WebSocket feature WIP
- `b35d190` - SSL cert issue remaining
- `257fe8e` - WebSocket via clawserver subdomain
- `b672f35` - CORS + logging for debugging
- `44d8fc4` - Auth re-enabled with CORS support

### Nginx Proxy Manager Config
- `clawpanel.fugjoo.duckdns.org` â†’ frontend:3000, HTTPS, WebSocket Support ON
- `clawserver.fugjoo.duckdns.org` â†’ backend:3001, HTTPS, WebSocket Support ON
- Both need valid Let's Encrypt SSL certificates

### Testing
- Manual WebSocket test: `node -e "ws = new WebSocket('wss://clawserver.../ws?token=...')"`
- Works with auth disabled and with token parameter
- Browser may cache old code - use incognito or different browser

### Status
- Backend: âœ… Running on port 3001
- Frontend: âœ… Running on port 3000
- WebSocket: ðŸŸ¡ Pending user re-login to save credentials